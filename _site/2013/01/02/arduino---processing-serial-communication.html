<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
  <title>Arduino -> Processing serial communication</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="author" content="Will Price" />
  <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/user.css">
	<link rel="stylesheet" href="/css/pygments.css">

  <! -- SCRIPTS
  ================================================== -->
  


	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->

	<!-- Delete everything in this .container and get started on your own site! -->

	<div class="container">
		<div class="sixteen columns">
      <div class="title">
        <a href="/about.html">Will Price</a>
        <a class="extra" href="/">Home</a>
        <a class="extra" href="/posts.html">Posts</a>
        <a class="extra" href="/projects">Projects</a>
        <a class="extra" href="/notes">Notes</a>
        <hr />
      </div>

      <section>
      <div class="content">
    <div id="post">
        <h2>Arduino -> Processing serial communication</h2>
        <h3 id='preface'>Preface</h3>

<p>I&#8217;ve started reading &#8220;Making Things Talk&#8221;, the first edition. I bought it a while ago when I had little experience with microcontrollers and had trouble even understanding what for loops were doing. Now I&#8217;m a little more experienced, I&#8217;m interested in learning how protocols work &#8211; this seemed liked the perfect book to consult for a beginner in communications.</p>

<p>Reading through the first chapter was fairly dull as I already knew most things, the conversation on debugging communications was interesting, something I&#8217;ll definitely refer to if I have issues.</p>

<p>In chapter 2, a project called &#8216;Monski Pong&#8217; is introduced, this involved a monkey with flex sensor attached to it&#8217;s arms. These sensors are read by an arduino which communicates it&#8217;s data via serial to a processing sketch, which uses it to control a game of pong. I was mostly interested in how the communication works, and less in the game of pong, however I did rewrite the game in an OO fashion (badly) to get some practice and make sure I don&#8217;t forget the syntax etc.</p>

<h3 id='communication'>Communication:</h3>

<p>The processing sketch sends the arduino linefeeds which are interpreted as requests for data, the arduino then sends the data and the sketch reads the data in as a string, trims it of whitespace and interprets it as a number.</p>
<div class='highlight'><pre><code class='java'><span class='cm'>/* PROCESSING CODE */</span>
<span class='kn'>import</span> <span class='nn'>processing.serial.*</span>

<span class='n'>Serial</span> <span class='n'>myPort</span><span class='o'>;</span>    <span class='c1'>// Declare serial port</span>
<span class='kt'>void</span> <span class='nf'>setup</span><span class='o'>()</span> <span class='o'>{</span>
   <span class='c1'>// Setup serial port as first available port, at 9600 baud</span>
   <span class='n'>myPort</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Serial</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>Serial</span><span class='o'>.</span><span class='na'>list</span><span class='o'>()[</span><span class='mi'>0</span><span class='o'>],</span> <span class='mi'>9600</span><span class='o'>);</span>

   <span class='c1'>// 10 in ASCII == linefeed</span>
   <span class='n'>myPort</span><span class='o'>.</span><span class='na'>bufferUntil</span><span class='o'>(</span><span class='mi'>10</span><span class='o'>);</span>
<span class='o'>}</span>
   
<span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{}</span>

<span class='kt'>void</span> <span class='nf'>serialEvent</span><span class='o'>(</span><span class='n'>Serial</span> <span class='n'>myPort</span><span class='o'>)</span> <span class='o'>{</span>
   <span class='c1'>// Read the data in the serial buffer until the linefeed</span>
   <span class='n'>String</span> <span class='n'>myString</span> <span class='o'>=</span> <span class='n'>myPort</span><span class='o'>.</span><span class='na'>readStringUntil</span><span class='o'>(</span><span class='n'>linefeed</span><span class='o'>);</span>

   <span class='c1'>// Clean up string, remove all whitespace from start and end</span>
   <span class='n'>myString</span> <span class='o'>=</span> <span class='n'>trim</span><span class='o'>(</span><span class='n'>myString</span><span class='o'>);</span>

   <span class='c1'>// If the string isn&#39;t just a linefeed, read the contents as the sensor value</span>
   <span class='k'>if</span> <span class='o'>(</span><span class='n'>myString</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='kt'>int</span> <span class='n'>sensor</span> <span class='o'>=</span> <span class='kt'>int</span><span class='o'>(</span><span class='n'>myString</span><span class='o'>);</span>
   
   <span class='c1'>// Display the value in the console</span>
   <span class='n'>println</span><span class='o'>(</span><span class='n'>sensor</span><span class='o'>);</span>
   
   <span class='c1'>// Send a linefeed to the arduino, to request another sensor value</span>
   <span class='n'>myPort</span><span class='o'>.</span><span class='na'>write</span><span class='o'>(</span><span class='sc'>&#39;\r&#39;</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre></div><div class='highlight'><pre><code class='c'><span class='cm'>/* ARDUINO CODE */</span>
<span class='kt'>int</span> <span class='n'>sensorVal</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span>

<span class='kt'>void</span> <span class='nf'>setup</span><span class='p'>()</span> <span class='p'>{</span>
   <span class='n'>Serial</span><span class='p'>.</span><span class='n'>begin</span><span class='p'>(</span><span class='mi'>9600</span><span class='p'>);</span>
<span class='p'>}</span>

<span class='kt'>void</span> <span class='nf'>loop</span><span class='p'>()</span> <span class='p'>{</span>
   <span class='n'>sensorVal</span> <span class='o'>=</span> <span class='n'>analogRead</span><span class='p'>(</span><span class='mi'>0</span><span class='p'>);</span>

   <span class='c1'>// Wait for a message</span>
   <span class='k'>if</span> <span class='p'>(</span><span class='n'>Serial</span><span class='p'>.</span><span class='n'>available</span><span class='p'>()</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='p'>)</span> <span class='p'>{</span>
      <span class='c1'>// Empty the serial buffer</span>
      <span class='kt'>int</span> <span class='n'>inByte</span> <span class='o'>=</span> <span class='n'>Serial</span><span class='p'>.</span><span class='n'>read</span><span class='p'>();</span>
      
      <span class='c1'>// Now send response</span>
      <span class='n'>Serial</span><span class='p'>.</span><span class='n'>print</span><span class='p'>(</span><span class='n'>sensorVal</span><span class='p'>)</span>
   <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
    </div>
</div>

 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'willprice'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </section>
    </div>
	</div><!-- container -->


<!-- End Document
================================================== -->
</body>
</html>
