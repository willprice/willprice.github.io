<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
  <title>AVR Programming with hackaday's tutorial</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="author" content="Will Price" />
  <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/user.css">
	<link rel="stylesheet" href="/css/pygments.css">
  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>

  <! -- SCRIPTS
  ================================================== -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script type="text/javascript" src="/scripts/toc.js"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-41410283-1', 'willprice.org');
    ga('send', 'pageview');
  </script>
  


	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->

	<!-- Delete everything in this .container and get started on your own site! -->

	<div class="container">
		<div class="sixteen columns">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/posts.html">Posts</a>
        <a class="extra" href="/about.html">About</a>
        <hr />
      </div>

      <section>
      <p>Using <a href="http://hackaday.com/2010/11/05/avr-programming-03-reading-and-compiling-code/">HackADay’s AVR tutorial</a> to learn a bit of AVR programming, hopefully so I can construct a 4x4x4 LED cube and write some routines to make some nice visual effects, the big goal is to write a frequency visualiser for it, taking an audio input and lighting up columns of LEDs according to the amplitude of different frequencies in the source wave. I’ll be content just writing routines to light up the LEDs prettily though for the time being.</p>

<p>Look at the <a href="../miscellaneous.md">Miscellaneous Notes</a> for a few general things I stumbled over + other things.</p>

<h1 id="hexadecimal-and-binary">Hexadecimal and Binary</h1>
<p>When dealing with binary numbers in C, it’s quickest to type them out in hexadecimal, this is surprisingly easy due to a nice little trick allowing you to interpret a byte as 2 nibbles (four bit quantities):</p>

<p><code class="highlighter-rouge">0x28 == 0010_1000</code></p>

<p><code class="highlighter-rouge">0xaf == 1010_1111</code></p>

<p>Simply take the first part of the hexadecimal number, for <code class="highlighter-rouge">0xaf</code> it’s <code class="highlighter-rouge">a</code>, which in binary is <code class="highlighter-rouge">1010</code> and then take the second part <code class="highlighter-rouge">f</code> which in binary is <code class="highlighter-rouge">1111</code>, then join them together -&gt; <code class="highlighter-rouge">10101111</code>.</p>

<h1 id="bitwise-operators">Bitwise Operators</h1>
<p>Refer to <a href="http://www.avrfreaks.net/index.php?name=PNphpBB2&amp;file=viewtopic&amp;t=37871">Programming 101</a> for an in-depth tutorial.</p>

<table border="1">
<tr><td>|    </td><td>OR         </td></tr>
<tr><td>&amp;</td><td>AND        </td></tr>
<tr><td>~    </td><td>NOT        </td></tr>
<tr><td>^    </td><td>XOR        </td></tr>
<tr><td>&lt;&lt;   </td><td>Shift Left </td></tr>
<tr><td>&gt;&gt;   </td><td>Shift Right</td></tr>
</table>

<ul>
  <li><code class="highlighter-rouge">foo |= 0x01</code> takes a byte foo, and set’s the <code class="highlighter-rouge">0x01</code> bit, think about the maths.</li>
  <li><code class="highlighter-rouge">foo &amp;= 0x01</code> will set foo as <code class="highlighter-rouge">0x01</code> if the first bit (as we’re using <code class="highlighter-rouge">0x01</code>) is set, otherwise it will set foo as <code class="highlighter-rouge">0x00</code></li>
  <li>Shift left and Shift right allow us to make binary numbers really easily, for example: 
<code class="highlighter-rouge">0x01</code></li>
</ul>

<h1 id="blink-code">Blink code</h1>

<figure class="highlight"><pre><code class="language-c" data-lang="c">  <span class="cm">/*
  * Hackaday.com AVR Tutorial firmware
  * written by: Mike Szczys (@szczys)
  * 10/24/2010
  *
  * ATmega168
  * Blinks one LED conneced to PD0
  *
  * http://hackaday.com/2010/10/25/avr-programming-02-the-hardware/
  */</span>

  <span class="cp">#include &lt;avr/io.h&gt;
</span>  <span class="cp">#include &lt;avr/interrupt.h&gt;
</span>
  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
  <span class="p">{</span>

    <span class="c1">//Setup the clock
</span>    <span class="n">cli</span><span class="p">();</span>      <span class="c1">//Disable global interrupts
</span>    <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">CS11</span> <span class="o">|</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">CS10</span><span class="p">;</span>  <span class="c1">//Divide by 64
</span>    <span class="n">OCR1A</span> <span class="o">=</span> <span class="mi">15624</span><span class="p">;</span>    <span class="c1">//Count 15624 cycles for 1 second interrupt
</span>    <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">WGM12</span><span class="p">;</span>   <span class="c1">//Put Timer/Counter1 in CTC mode
</span>    <span class="n">TIMSK1</span> <span class="o">|=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">OCIE1A</span><span class="p">;</span>    <span class="c1">//enable timer compare interrupt
</span>    <span class="n">sei</span><span class="p">();</span>      <span class="c1">//Enable global interrupts
</span>
    <span class="c1">//Setup the I/O for the LED
</span>
    <span class="n">DDRD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">);</span>   <span class="c1">//Set PortD Pin0 as an output
</span>    <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">);</span>    <span class="c1">//Set PortD Pin0 high to turn on LED
</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>      <span class="c1">//Loop forever, interrupts do the rest
</span>  <span class="p">}</span>

  <span class="n">ISR</span><span class="p">(</span><span class="n">TIMER1_COMPA_vect</span><span class="p">)</span>    <span class="c1">//Interrupt Service Routine
</span>  <span class="p">{</span>
    <span class="n">PORTD</span> <span class="o">^=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">);</span>    <span class="c1">//Use xor to toggle the LED
</span>  <span class="p">}</span>  </code></pre></figure>

<p>Right, this to me looks like gobbledygook, regardless of having programmed in Processing…
<code class="highlighter-rouge">int main(void)</code> is the start of the program, <code class="highlighter-rouge">main</code> is responsible for starting execution, it’s just an arbitrary function name that is now used in every programming language. 
Let’s start off by looking at the program line by line, the top lines starting with <code class="highlighter-rouge">#include</code> tell the C-preprocessor to include the files in angle brackets, this makes some 
useful functions available. The largest chunk of code which resides in main sets up the clock, so that the LED is flashed every second.</p>

<p><code class="highlighter-rouge">cli()</code> allows you to disable all global interupts, so you know, from there on, nothing will interupt the execution of your code (apart from pulling the power), to re-enable the global interrupts (they’re useful) use <code class="highlighter-rouge">sei()</code></p>

<p><code class="highlighter-rouge">unsigned char &lt;var_name&gt;</code> is used to declare a byte (0-255).</p>

      </section>
    </div>
    <script type="text/javascript">
      $(document).ready(function() {
        $('.toc').toc();
      });
    </script>
  </div>
  <!-- container -->


<!-- End Document
================================================== -->
</body>
</html>
