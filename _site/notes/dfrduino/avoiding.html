<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
  <title></title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="author" content="Will Price" />
  <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/user.css">
	<link rel="stylesheet" href="/css/pygments.css">
  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>

  <! -- SCRIPTS
  ================================================== -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-41410283-1', 'willprice.org');
    ga('send', 'pageview');
  </script>
  


	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->

	<!-- Delete everything in this .container and get started on your own site! -->

	<div class="container">
		<div class="sixteen columns">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/posts.html">Posts</a>
        <a class="extra" href="/about.html">About</a>
        <hr />
      </div>

      <section>
      <h1 id="avoiding-obstacles">Avoiding obstacles</h1>

<p>You&#39;ve learnt lots! We&#39;ve covered all the functions in the library, you can
bring all this functionality together to make an obstacle avoiding robot. I&#39;ve
purposefully left this very open ended. I shall give you an example of some code
I wrote to do obstacle avoidance, it&#39;s not very good, please improve it! Better
yet define some new heuristics and try them out!</p>

<div class="highlight"><pre><code class="c"><span class="cp">#include &lt;DFRduino.h&gt;</span>
<span class="cp">#include &lt;Servo.h&gt;</span>

<span class="n">DFRduino</span> <span class="n">robot</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">explore</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">explore</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setMotors</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Don&#39;t move while we survey the obstacles!</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setMotors</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">leftDistance</span> <span class="o">=</span> <span class="n">lookLeft</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">rightDistance</span> <span class="o">=</span> <span class="n">lookRight</span><span class="p">();</span>
    <span class="n">makeDecisionOnWhereToTurnNext</span><span class="p">(</span><span class="n">leftDistance</span><span class="p">,</span> <span class="n">rightDistance</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">makeDecisionOnWhereToTurnNext</span><span class="p">(</span><span class="kt">int</span> <span class="n">leftDistance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rightDistance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">leftDistance</span> <span class="o">&gt;</span> <span class="n">rightDistance</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">&#39;l&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">&#39;r&#39;</span><span class="p">);</span>
  <span class="p">}</span> 
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">&#39;b&#39;</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lookLeft</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">();</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">distance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lookRight</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">();</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">distance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">resetHeadPosition</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">120</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">waitForServoToReachPosition</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<p>A few tips:</p>

<ul>
<li>Break all your complex behaviour into functions, as you can see I&#39;ve got
<code>lookLeft</code> and <code>lookRight</code> to get the distance when looking left and right.</li>
<li>Use the serial port to print out values when you&#39;re not sure why your robot is
doing something unexpected</li>
<li>Tilting the head down can cause the IR sensor to pick up the floor, you may or
may not want this; it could be part of quite a good heuristic.</li>
</ul>

      </section>
    </div>
	</div><!-- container -->


<!-- End Document
================================================== -->
</body>
</html>
