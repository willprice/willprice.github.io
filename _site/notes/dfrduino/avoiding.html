<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="Will Price">
    <meta name="description" content="">
    <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Slab">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/user.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/scripts/toc.js"></script>
    <script src="/scripts/ganalytics.js"></script>
    
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/">Posts</a>
        <!-- Notes need more cleaning up before being visible for
             browsing!
        <a class="extra" href="/notes">Notes</a>
        -->
        <a class="extra" href="/about.html">About</a>
        <hr />
      </div>
      <section>
        <h1 id="avoiding-obstacles">Avoiding obstacles</h1>
<p>You’ve learnt lots! We’ve covered all the functions in the library, you can
bring all this functionality together to make an obstacle avoiding robot. I’ve
purposefully left this very open ended. I shall give you an example of some code
I wrote to do obstacle avoidance, it’s not very good, please improve it! Better
yet define some new heuristics and try them out!</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;DFRduino.h&gt;
#include &lt;Servo.h&gt;
</span>
<span class="n">DFRduino</span> <span class="n">robot</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">explore</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">explore</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setMotors</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Don't move while we survey the obstacles!
</span>    <span class="n">robot</span><span class="p">.</span><span class="n">setMotors</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">leftDistance</span> <span class="o">=</span> <span class="n">lookLeft</span><span class="p">();</span>
    <span class="kt">int</span> <span class="n">rightDistance</span> <span class="o">=</span> <span class="n">lookRight</span><span class="p">();</span>
    <span class="n">makeDecisionOnWhereToTurnNext</span><span class="p">(</span><span class="n">leftDistance</span><span class="p">,</span> <span class="n">rightDistance</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">makeDecisionOnWhereToTurnNext</span><span class="p">(</span><span class="kt">int</span> <span class="n">leftDistance</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rightDistance</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">leftDistance</span> <span class="o">&gt;</span> <span class="n">rightDistance</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">'l'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">'r'</span><span class="p">);</span>
  <span class="p">}</span> 
  <span class="k">if</span> <span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">robot</span><span class="p">.</span><span class="n">setDirection</span><span class="p">(</span><span class="sc">'b'</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lookLeft</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">();</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">distance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">lookRight</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">robot</span><span class="p">.</span><span class="n">readDistanceInCentimeters</span><span class="p">();</span>
  <span class="n">resetHeadPosition</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">distance</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">resetHeadPosition</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">120</span><span class="p">);</span>
  <span class="n">waitForServoToReachPosition</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">waitForServoToReachPosition</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>A few tips:</p>

<ul>
  <li>Break all your complex behaviour into functions, as you can see I’ve got
<code class="highlighter-rouge">lookLeft</code> and <code class="highlighter-rouge">lookRight</code> to get the distance when looking left and right.</li>
  <li>Use the serial port to print out values when you’re not sure why your robot is
doing something unexpected</li>
  <li>Tilting the head down can cause the IR sensor to pick up the floor, you may or
may not want this; it could be part of quite a good heuristic.</li>
</ul>

      </section>
    </div>

    <script type="text/javascript">
      $(document).ready(function() {
        $('.toc').toc();
      });
    </script>
  </body>
</html>
