<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="Will Price">
    <meta name="description" content="">
    <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Slab">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/user.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/scripts/toc.js"></script>
    <script src="/scripts/ganalytics.js"></script>
    
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/">Posts</a>
        <!-- Notes need more cleaning up before being visible for
             browsing!
        <a class="extra" href="/notes">Notes</a>
        -->
        <a class="extra" href="/about.html">About</a>
        <hr />
      </div>
      <section>
        <h1 id="nodding-and-moving-your-robots-head">Nodding and moving your robot’s head</h1>
<p>Notice how your robot’s IR sensor is mounted on a frame that can move in 2
planes? Try moving it with your hand, don’t be too vigorous with them, they’re
rather flimsy and plastic!</p>

<p>So it’s all well and good moving the head by hand, but it would be much more
userful doing this programmatically. There are two <a href="http://youtu.be/bMXx25Q5s24">servo
motors</a> attached to each bracket, allow 180 degrees
of control. We can make the robot look left and right; and up and down, so let’s
do just that:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;Servo.h&gt;
#include &lt;DFRduino.h&gt;
</span>

<span class="n">DFRduino</span> <span class="n">robot</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Look forward
</span>  <span class="c1">// Unfortunately my robot's vertical servo is not calibrated very
</span>  <span class="c1">// well, so looking ahead is 130 degrees, less points it up, more
</span>  <span class="c1">// makes it click a lot -- if your's clicks a lot, pull out the cable,
</span>  <span class="c1">// and rewrite your code so that it won't put it to such extreme a
</span>  <span class="c1">// position
</span>  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">130</span><span class="p">);</span>
  <span class="c1">// Wait for the servo to move
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="c1">// Look upwards
</span>  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
  <span class="c1">// Wait for the servo to move
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>You may find that your robot’s head isn’t pointing forward, so we can modify the
sketch above to do that using <code class="highlighter-rouge">setHorizontalHeadPosition</code>, this works as you’d
expected, unlike <code class="highlighter-rouge">setVerticalHeadPosition</code>:</p>

<ul>
  <li>0 degrees   - Right</li>
  <li>90 degrees  - Centre</li>
  <li>180 degrees - Left</li>
</ul>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;Servo.h&gt;
#include &lt;DFRduino.h&gt;
</span>

<span class="n">DFRduino</span> <span class="n">robot</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// We set the horizontal head position just once.
</span>  <span class="c1">// There's no point repeatedly doing it as we're not changing it in
</span>  <span class="c1">// our loop.
</span>  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Look forward
</span>  <span class="c1">// Unfortunately my robot's vertical servo is not calibrated very
</span>  <span class="c1">// well, so looking ahead is 130 degrees, less points it up, more
</span>  <span class="c1">// makes it click a lot -- if your's clicks a lot, pull out the cable,
</span>  <span class="c1">// and rewrite your code so that it won't put it to such extreme a
</span>  <span class="c1">// position
</span>  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">130</span><span class="p">);</span>
  <span class="c1">// Wait for the servo to move
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="c1">// Look upwards
</span>  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
  <span class="c1">// Wait for the servo to move
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>We could do something more interesting…</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;Servo.h&gt;
#include &lt;DFRduino.h&gt;
</span>

<span class="n">DFRduino</span> <span class="n">robot</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">xIncrement</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">yIncrement</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// '||' means OR
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">180</span> <span class="o">||</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">xIncrement</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// The furthest down y can go is 160 degrees. If it tries to go more
</span>  <span class="c1">// than that the library will print out an error in the serial monitor
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">160</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 
</span>    <span class="n">yIncrement</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">x</span> <span class="o">+=</span> <span class="n">xIncrement</span><span class="p">;</span>
  <span class="n">y</span> <span class="o">+=</span> <span class="n">yIncrement</span><span class="p">;</span>

  <span class="n">robot</span><span class="p">.</span><span class="n">setHorizontalHeadPosition</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
  <span class="n">robot</span><span class="p">.</span><span class="n">setVerticalHeadPosition</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>See if you can figure this out by reading the code, If not, read on!</p>

<ol>
  <li>Set <code class="highlighter-rouge">x = 0</code>, <code class="highlighter-rouge">y = 0</code>.</li>
  <li>Each time we loop check to see if <code class="highlighter-rouge">x &gt; 180</code> or <code class="highlighter-rouge">x &lt; 0</code>, if this is the case,
then change the sign of <code class="highlighter-rouge">xIncrement</code> (so we either increase, or decrease our
angle)</li>
  <li>Each time we loop check to see if <code class="highlighter-rouge">y &gt; 160</code> or <code class="highlighter-rouge">y &lt; 0</code>, if this is the case,
then change the sign of <code class="highlighter-rouge">yIncrement</code> (so we either increase, or decrease our
angle)</li>
  <li>Add <code class="highlighter-rouge">xIncrement</code> to <code class="highlighter-rouge">x</code> and add <code class="highlighter-rouge">yIncrement</code> to <code class="highlighter-rouge">y</code>.</li>
  <li>Set our angles by <code class="highlighter-rouge">x</code> and <code class="highlighter-rouge">y</code>.</li>
  <li>Delay for 20ms, this gives our servo a bit of time to move 1 degree. Play
around with this value, see how fast it can go before it doesn’t operate
correctly. Can you explain what happens when you leave the delay out?</li>
</ol>

<p>Time to move on and use everything you’ve learnt to <a href="avoiding.html">write an obstacle avoidance
program for your robot</a></p>

      </section>
    </div>

    <script type="text/javascript">
      $(document).ready(function() {
        $('.toc').toc();
      });
    </script>
  </body>
</html>
