<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Maths</title>
    <meta name="author" content="Will Price">
    <meta name="description" content="">
    <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/skeleton.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto+Slab">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/user.css">

    <link rel="shortcut icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="/scripts/toc.js"></script>
    <script src="/scripts/ganalytics.js"></script>
    
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/">Posts</a>
        <!-- Notes need more cleaning up before being visible for
             browsing!
        <a class="extra" href="/notes">Notes</a>
        -->
        <a class="extra" href="/about.html">About</a>
        <hr />
      </div>
      <section>
        <h1 id="maths">Maths</h1>
<h2 id="algorithms">Algorithms</h2>
<h3 id="stable-roommate-problem">Stable Roommate problem</h3>

<h4 id="terminology">Terminology</h4>
<ul>
  <li><em>stable matching</em>: A solution where everyone is paired in such a way that no
two roommates would prefer to be together, than in their current match.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>INPUT: a map of roommates to their strict preferences
OUTPUT: a map of roommates to their best match if possible, else nothing

while there are unmatched people do:
    let 'proposer' be the earliest roommate in the input that hasn't been
    matched.

    'proposer' proposes to the highest preference roommate, the 'recipient', in
    his preferences that hasn't already rejected him.

    if the 'recipient' has not received a proposal before then:
        the 'recipient' accepts the 'proposer'
    else if the 'recipient' prefers the 'proposer' over her current match then:
        the 'recipient' accepts the 'proposer'
    else:
        the 'recipient' rejects the 'proposer'

for all accepted proposals ('proposer' -&gt; 'recipient'):
    reject all pairings where ('recipient' -&gt; 'other_person') and 'other_person'
    has a lower ranking preference in the 'recipient's preferences compared to
    'proposer'.

for all cycles ('person_1', ... , 'person_n') and associated second preferences
('second_pref_1', ... , 'second_pref_n'):
    let 'second_pref_i' be the second preference of 'person_(i-1)'
    for all pairs ('person_(i+1)', 'second_pref_(i)'):
        'second_pref_i' rejects 'person_(i+1)'
</code></pre>
</div>

<p>While this pseudo code may be a little obtuse at first, you may find that in
addition to simple English description of how to perform the algorithm by hand
the algorithm will become quite clear in how it works.</p>

<p>We split the algorithm into three phases:</p>

<ol>
  <li>Gale-Shapley algorithm.</li>
  <li>Remove lesser preferences from recipients.</li>
  <li>Eliminate remaining preferences by analysis of cycles.</li>
</ol>

<h4 id="rejecting-a-proposal">Rejecting a proposal</h4>

<p>By rejecting a proposal <code class="highlighter-rouge">A -&gt; B</code>, you must cross off both <code class="highlighter-rouge">B</code> in <code class="highlighter-rouge">A</code>s
preferences and <code class="highlighter-rouge">A</code> in <code class="highlighter-rouge">B</code>s preferences. In other words, every rejection
consists of removing two preferences from the preferences table.</p>

<h4 id="phase-1-gale-shapley-algorithm">Phase 1: Gale-Shapley algorithm</h4>

<p>The Gale-Shapley algorithm was designed for a very similar problem to the
finding a stable matching for roommates, but instead of roommates the population
was split into two halves, males, and females, each of whom had their own
preferences. Only one gender would propose to the other to find a stable
matching.</p>

<p>We apply this algorithm to the roommates and their associated preferences.</p>

<ol>
  <li>Pick the first roommate on the list that hasn’t had one of their proposals
accepted, we shall call her the <em>proposer</em></li>
  <li>The <em>proposer</em> proposes to her first preference, the <em>recipient</em>, that hasn’t already rejected
her. If the <em>recipient</em> hasn’t had a proposal before, then he accepts,
otherwise if the <em>proposer</em> is of a higher preference to the <em>recipient</em> than
the <em>recipient</em> current match, the <em>recipient</em> accepts the proposal and
reject his previous match.</li>
  <li>Go to 1 whilst there are still unmatched roommates.</li>
</ol>

<h4 id="phase-2-removing-lesser-preferences">Phase 2: Removing lesser preferences</h4>

<p>For every accepted proposal where <em>proposer</em> has been accepted by <em>recipient</em>,
reject all lower preferences then the <em>proposer</em> in the <em>recipients</em> preference
list</p>

<h4 id="phase-3-eliminating-remaining-preferences-by-analysis-of-cycles">Phase 3: Eliminating remaining preferences by analysis of cycles</h4>

<p>For every roommate that has more than one preference left in the preferences
table, write down a table where the top element is the roommate, and the one
below it is the 2nd preference of the roommate, then the next top element is the
last preference of the element one cell below and behind. Essentially in
constructing the table:</p>

<ol>
  <li>Fill in the cell below you current position with the 2nd preference of the
current element</li>
  <li>Fill in the cell to the upper right of your current position with the last
preference of the current element</li>
</ol>

<p>Or in other words: to go down, put the 2nd preference, and to go diagonally it’s
the last preference.</p>

<p>Continue constructing the table until you reach a cycle in the top row. Then
reject all diagonal pairs (bottom left to upper right).</p>

<p>You should end up with a preferences table where each roommate has a single
preference</p>

<h4 id="exceptions">Exceptions</h4>

<p>If you find that a roommate is rejected by everyone in a set of an even number
of roommates, then there will be no stable matching.</p>

      </section>
    </div>

    <script type="text/javascript">
      $(document).ready(function() {
        $('.toc').toc();
      });
    </script>
  </body>
</html>
