<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
  <title>TP-Link WR703N, OpenWRT and MPD</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="author" content="Will Price" />
  <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/user.css">
	<link rel="stylesheet" href="/css/pygments.css">

  <! -- SCRIPTS
  ================================================== -->
  


	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->

	<!-- Delete everything in this .container and get started on your own site! -->

	<div class="container">
		<div class="sixteen columns">
      <div class="title">
        <a href="/about.html">Will Price</a>
        <a class="extra" href="/">Home</a>
        <a class="extra" href="/posts.html">Posts</a>
        <a class="extra" href="/projects">Projects</a>
        <a class="extra" href="/notes">Notes</a>
        <hr />
      </div>

      <section>
      <div class="content">
    <div id="post">
        <h2>TP-Link WR703N, OpenWRT and MPD</h2>
        <p>Finally, a post&#8230;</p>

<p>I bought a <a href='http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273'>TP-Link WR703N</a>, it&#8217;s a little router meant to be used in conjunction with a 3G Modem, it works as an access point broadcasting a wireless connection allowing multiple devices to utilize the modem at once (quite a clever idea, however, not one I&#8217;m interested in using), hence I decided to flash it with <a href='https://openwrt.org/'>OpenWRT</a></p>

<h4 id='specs'>Specs:</h4>

<ul>
<li>RAM - 32Mb</li>

<li>ROM - 4Mb</li>

<li>USB port (USB2)</li>

<li>CPU - Atheros AR7240 - 400Mhz</li>

<li>Wireless - Atheros AR9331 - b/g/n</li>
</ul>

<p>Powered by a micro usb port, 5.7cm x 5.7cm, serial interface. (These are just the basics, more <a href='http://wiki.openwrt.org/toh/tp-link/tl-wr703n'>here</a></p>

<p>OpenWRT Install: The device comes preinstalled with Chinese firmware, I connected the router via ethernet and configured Arch to have the IP 192.168.1.2 (in /etc/rc.conf) but you could also easily use wifi to upload the new firmware.</p>

<p>After connecting to the router, keep hovering over the menu items, the page file names are in English, keep expanding the drop down menus until you find one with a page name similar to &#8216;software upgrade&#8217;, something along those lines (I do believe it&#8217;s in one of the last sections). Go to the OpenWRT wiki and download the &#8216;vanilla&#8217; firmware for the router, upload this, once the router has upgraded the firmware, it should reboot.</p>

<p>Having now installed the OpenWRT firmware, you can connect to the router via the ethernet port if you configure your computer&#8217;s IP to be 192.168.1.2, telnet into the router using: telnet 192.168.1.1 There you are presented with the CLI of the router where you can start manipulating things. Use opkg update to update the packages list and opkg install <em>package name</em> to install applications</p>

<p>These are simply the basics and much more informative instructions can be found on the OpenWRT forums and wiki.</p>

<h4 id='openwrt_configuration'>OpenWRT Configuration:</h4>

<p>I wanted to use the router as a wireless client (i.e. similar to a computer), I used the following network configurations</p>
<div class='highlight'><pre><code class='sh'><span class='c'># /etc/config/network</span>

config <span class='s1'>&#39;interface&#39;</span> <span class='s1'>&#39;loopback&#39;</span>
 option <span class='s1'>&#39;ifname&#39;</span> <span class='s1'>&#39;lo&#39;</span>
 option <span class='s1'>&#39;proto&#39;</span> <span class='s1'>&#39;static&#39;</span>
 option <span class='s1'>&#39;ipaddr&#39;</span> <span class='s1'>&#39;127.0.0.1&#39;</span>
 option <span class='s1'>&#39;netmask&#39;</span> <span class='s1'>&#39;255.0.0.0&#39;</span>


config <span class='s1'>&#39;interface&#39;</span> <span class='s1'>&#39;lan&#39;</span>
 option <span class='s1'>&#39;ifname&#39;</span> <span class='s1'>&#39;eth0&#39;</span>
 option <span class='s1'>&#39;type&#39;</span> <span class='s1'>&#39;bridge&#39;</span>
 option <span class='s1'>&#39;proto&#39;</span> <span class='s1'>&#39;static&#39;</span>
 option <span class='s1'>&#39;ipaddr&#39;</span> <span class='s1'>&#39;192.168.1.1&#39;</span>
 option <span class='s1'>&#39;netmask&#39;</span> <span class='s1'>&#39;255.255.255.0&#39;</span>


config <span class='s1'>&#39;interface&#39;</span> <span class='s1'>&#39;wan&#39;</span>
 option <span class='s1'>&#39;proto&#39;</span> <span class='s1'>&#39;dhcp&#39;</span>
</code></pre>
</div><div class='highlight'><pre><code class='sh'><span class='c'># /etc/config/wireless</span>

config <span class='s1'>&#39;wifi-device&#39;</span> <span class='s1'>&#39;radio0&#39;</span>
 option <span class='s1'>&#39;type&#39;</span> <span class='s1'>&#39;mac80211&#39;</span>
 option <span class='s1'>&#39;channel&#39;</span> <span class='s1'>&#39;11&#39;</span>
 option <span class='s1'>&#39;macaddr&#39;</span> <span class='s1'>&#39;38:83:45:a2:14:18&#39;</span>
 option <span class='s1'>&#39;hwmode&#39;</span> <span class='s1'>&#39;11ng&#39;</span>
 option <span class='s1'>&#39;htmode&#39;</span> <span class='s1'>&#39;HT20&#39;</span>
 list <span class='s1'>&#39;ht_capab&#39;</span> <span class='s1'>&#39;SHORT-GI-20&#39;</span>
 list <span class='s1'>&#39;ht_capab&#39;</span> <span class='s1'>&#39;SHORT-GI-40&#39;</span>
 list <span class='s1'>&#39;ht_capab&#39;</span> <span class='s1'>&#39;RX-STBC1&#39;</span>
 list <span class='s1'>&#39;ht_capab&#39;</span> <span class='s1'>&#39;DSSS_CCK-40&#39;</span>

config <span class='s1'>&#39;wifi-iface&#39;</span>
 option <span class='s1'>&#39;device&#39;</span> <span class='s1'>&#39;radio0&#39;</span>
 option <span class='s1'>&#39;network&#39;</span> <span class='s1'>&#39;wan&#39;</span> <span class='c'>#Set the adapter to act as a wide area network -- not sure why</span>
 option <span class='s1'>&#39;ssid&#39;</span> <span class='s1'>&#39;Price LAN&#39;</span>
 option <span class='s1'>&#39;key&#39;</span> <span class='s1'>&#39;*******&#39;</span>
 option <span class='s1'>&#39;encryption&#39;</span> <span class='s1'>&#39;psk2&#39;</span> <span class='c'># My network uses psk2 security</span>
 option <span class='s1'>&#39;mode&#39;</span> <span class='s1'>&#39;sta&#39;</span> <span class='c'>#Setup client mode</span>
</code></pre>
</div>
<p>In the section &#8216;config &#8216;wifi-iface&#8221; I&#8217;ve setup the router to act as a client by setting the &#8216;mode&#8217; to &#8216;sta&#8217; which sets the router to act as a client rather than an access point.</p>

<h4 id='usb_support'>USB Support:</h4>

<p>I needed USB support as the router only has a 4mb flash which isn&#8217;t sufficient to install transmission, mpd, mpc etc. I updated /etc/opkg.conf to remedy this (look at the wiki page on opkg, there is a section on how to do this).</p>

<p>Now I could install to my memory stick using the command opkg -d usb install <em>package name</em> This usually works fairly well, I had to update my PATH variable in /etc/profile to reflect the new install directories.</p>

<p>I&#8217;ve also played around in /etc/rc.local setting up some startup applications. I&#8217;ve got mpd, transmission-daemon and mpc (adding playlists) on startup.</p>

<h4 id='links'>Links:</h4>

<ul>
<li><span>1</span> - $22/Â£15 - <a href='http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273'>http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273</a></li>

<li><span>2</span> - <a href='https://openwrt.org/'>https://openwrt.org/</a></li>

<li><span>3</span> - OpenWRT wiki page on WR703N - <a href='http://wiki.openwrt.org/toh/tp-link/tl-wr703n'>http://wiki.openwrt.org/toh/tp-link/tl-wr703n</a></li>
</ul>

<p>I might continue to update this post as I progress with the project. I aim to use this router to act as a internet radio, I&#8217;ll probably use an arduino to interface it with an LCD and rotary encoder.</p>
    </div>
</div>

 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'willprice'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </section>
    </div>
	</div><!-- container -->


<!-- End Document
================================================== -->
</body>
</html>
