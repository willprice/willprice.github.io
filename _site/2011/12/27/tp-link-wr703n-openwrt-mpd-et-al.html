<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

	<!-- Basic Page Needs
  ================================================== -->
  <title>TP-Link WR703N, OpenWRT, MPD et al</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="author" content="Will Price" />
  <link href="http://feeds.feedburner.com/willpriceblog" type="application/atom+xml" title="Will Price" rel="alternative"/>
	<meta name="description" content="">
	<meta name="author" content="">

	<!-- Mobile Specific Metas
  ================================================== -->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<!-- CSS
  ================================================== -->
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
  <link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/user.css">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="apple-touch-icon" href="images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">

</head>
<body>



	<!-- Primary Page Layout
	================================================== -->

	<!-- Delete everything in this .container and get started on your own site! -->

	<div class="container">
		<div class="sixteen columns">
      <div class="title">
        <a href="/">Will Price</a>
        <a class="extra" href="/">Home</a>
        <a class="extra" href="/posts.html">Posts</a>
        <a class="extra" href="/projects">Projects</a>
        <hr />
      </div>

      <section>
      <div class="content">
    <div id="post">
        <h2>TP-Link WR703N, OpenWRT, MPD et al</h2>
        <div class='post'>
Finally, a post....<br />I bought a TP-Link WR703N <a href="http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273">[1]</a>, it's a little router meant to be used&nbsp;in conjunction&nbsp;with a 3G Modem, it works as an access point broadcasting a wireless connection allowing multiple devices to&nbsp;utilize&nbsp;the modem at once (quite a clever idea, however, not one I'm interested in using), hence I decided to flash it with OpenWRT <a href="https://openwrt.org/">[2]</a><br /><b><br />Specs:</b><br />RAM - 32Mb<br />ROM - 4Mb<br />USB port (USB2)<br />CPU - Atheros AR7240 - 400Mhz<br />Wireless - Atheros AR9331 - b/g/n<br /><br />Powered by a micro usb port, 5.7cm x 5.7cm, serial interface.<br />(These are just the basics, more here&nbsp;<a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n">[3]</a>)<br /><br /><b>OpenWRT Install:</b><br />The device comes preinstalled with&nbsp;Chinese&nbsp;firmware, I connected the router via ethernet and configured Arch to have the IP 192.168.1.2 (in /etc/rc.conf) but you could also easily use wifi to upload the new firmware.<br /><br />After connecting to the router, keep hovering over the menu items, the page file names are in English, keep expanding the drop down menus until you find one with a page name similar to 'software upgrade', something along those lines (I do believe it's in one of the last sections). Go to the OpenWRT wiki and download the 'vanilla' firmware for the router, upload this, once the router has upgraded the firmware, it should reboot.<br /><br />Having now installed the OpenWRT firmware, you can connect to the router via the ethernet port if you configure your computer's IP to be 192.168.1.2, telnet into the router using:<br /><i>telnet 192.168.1.1</i><br />There you are presented with the CLI of the router where you can start manipulating things. Use <i>opkg update</i>&nbsp;to update the packages list and <i>opkg install *package name* </i>to install applications<br /><br />These are simply the basics and much more informative instructions can be found on the OpenWRT forums and wiki.<br /><br /><b>OpenWRT Configuration:</b><br />I wanted to use the router as a wireless client (i.e. similar to a computer), I used the following network configurations<br /><br /><u>/etc/config/network</u><br /><br /><i>config 'interface' 'loopback'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'ifname' 'lo'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'proto' 'static'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'ipaddr' '127.0.0.1'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'netmask' '255.0.0.0'</i><br /><i><br /></i><br /><i>config 'interface' 'lan'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'ifname' 'eth0'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'type' 'bridge'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'proto' 'static'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'ipaddr' '192.168.1.1'</i><br /><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'netmask' '255.255.255.0'</i><br /><i><br /></i><br /><i><b>config 'interface' 'wan'</b></i><br /><i><b><span style="white-space: pre;">&nbsp;</span>option 'proto' 'dhcp'</b></i><br /><div style="text-decoration: underline;"><br /></div><div><u>/etc/config/wireless</u></div><div><div><i>config 'wifi-device' 'radio0'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'type' 'mac80211'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'channel' '11'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'macaddr' '38:83:45:a2:14:18'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'hwmode' '11ng'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'htmode' 'HT20'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>list 'ht_capab' 'SHORT-GI-20'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>list 'ht_capab' 'SHORT-GI-40'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>list 'ht_capab' 'RX-STBC1'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>list 'ht_capab' 'DSSS_CCK-40'</i></div><div><i><br /></i></div><div><i>config 'wifi-iface'</i></div><div><i><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'device' 'radio0'</i></div><div><i><b><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'network' 'wan' </b>#Set the adapter to act as a wide area network -- not sure why</i></div><div><i><b><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'ssid' 'Price LAN'</b></i></div><div><i><b><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'key' '*******'</b></i></div><div><i><b><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'encryption' 'psk2' </b># My network uses psk2 security</i></div><div><i><b><span class="Apple-tab-span" style="white-space: pre;"> </span>option 'mode' 'sta' </b>#Setup client mode</i></div><div style="text-decoration: underline;"><br /></div></div><div>In the section 'config 'wifi-iface'' I've setup the router to act as a client by setting the 'mode' to 'sta' which sets the router to act as a client rather than an access point.<br /><br /><b><u>USB Support:</u></b><br />I needed USB support as the router only has a 4mb flash which isn't sufficient to install transmission, mpd, mpc etc. I updated<br />/etc/opkg.conf to remedy this (look at the wiki page on opkg, there is a section on how to do this).<br /><br />Now I could install to my memory stick using the command<br /><i>opkg -d usb install *package name*</i><br />This usually works fairly well, I had to update my PATH variable in /etc/profile to reflect the new install directories.<br /><br />I've also played around in /etc/rc.local setting up some startup applications.<br />I've got mpd, transmission-daemon and mpc (adding playlists) on startup.&nbsp;</div><br /><b>Links:</b><br />[1] - $22/Â£15 -&nbsp;<a href="http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273">http://www.volumerates.com/product/genuine-tp-link-tl-wr703n-150m-11n-mini-wifi-wireless-router-for-instant-wifi-connection-99273</a><br />[2] -&nbsp;<a href="https://openwrt.org/">https://openwrt.org/</a><br />[3] - OpenWRT wiki page on WR703N -&nbsp;<a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n">http://wiki.openwrt.org/toh/tp-link/tl-wr703n</a><br /><br /><b>I might continue to update this post as I progress with the project. I aim to use this router to act as a internet radio, I'll probably use an arduino to interface it with an LCD and rotary encoder.</b></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>deff</div>
<div class='content'>
yeah lot is cached; but it surprise me to have stuff cached at startup^^, the reason was a bad rc.local on launch but it doesnt ponder my problem with mpd.<br />mpd is still  taking a whole 22 mb of ram on a clean launch. ( from reboot after rc.local load nfs and mpd , correctly this time)<br />I m pretty sure the culprit is the mpd-full package but mpd mini doesnt have alsa, that is a total deal breaker for susb card while the full has a lot of useless stuff. I guess i m gonna need to crosscompile mpd, and I m not a big fan, especially with mpd and it s number of optional, not so optional dependencies. Thought for 10 euro the wr703N is an awesome deal.<br />Tell me if you have a different result.<br />I also have 3 dockstar to play with!</div>
</div>
<div class='comment'>
<div class='author'>Will Price</div>
<div class='content'>
I can&#39;t see any problems from your top output but 11mb free at startup seems a bit low as that means you&#39;re somehow using 21mb or RAM? Are you sure you&#39;re just misreading the output of &#39;free&#39; and not factoring in the amount of memory that is cached (Linux puts aside a lot of memory in a cache/buffer for use when opening programs)<br /><br />I&#39;ll get my WR703N out at the weekend and play around</div>
</div>
<div class='comment'>
<div class='author'>deff</div>
<div class='content'>
well, mpd mini doesn t come with alsa support, while mpd full which suck my ram dry has it. I use nfs for install which to my taste is a more elgant solution because i have more than wr703n, and i have something like less than 1mb or ram free<br /><br />top give :<br />1154     1 root     S     1500   5%   0% /usr/sbin/ntpd -n -p 0.openwrt.pool.n<br /> 2125  2118 root     R     1500   5%   0% top<br /> 2117  1096 root     S     1216   4%   0% /usr/sbin/dropbear -P /var/run/dropbe<br />    3     2 root     SW       0   0%   0% [ksoftirqd/0]<br />  595     1 root     S     1512   5%   0% /sbin/netifd<br />  579     1 root     S     1508   5%   0% /sbin/syslogd -C16<br />    1     0 root     S     1504   5%   0% init<br />  455     1 root     S     1504   5%   0% init<br /> 2118  2117 root     S     1504   5%   0% -ash<br />  830     1 root     S     1500   5%   0% /sbin/watchdog -t 5 /dev/watchdog<br />  581     1 root     S     1488   5%   0% /sbin/klogd<br />  870     1 root     S     1408   5%   0% hostapd -P /var/run/wifi-phy0.pid -B<br /> 1096     1 root     S     1152   4%   0% /usr/sbin/dropbear -P /var/run/dropbe<br /> 1141     1 nobody   S      936   3%   0% /usr/sbin/dnsmasq -C /var/etc/dnsmasq<br />  589     1 root     S      860   3%   0% /sbin/ubusd<br />  583     1 root     S      852   3%   0% /sbin/hotplug2 --override --persisten<br />  250     2 root     SW       0   0%   0% [kworker/0:1]<br />  437     2 root     SWN      0   0%   0% [jffs2_gcd_mtd3]<br />    7     2 root     SW       0   0%   0% [kworker/u:1]<br />  194     2 root     SW       0   0%   0% [mtdblock2]<br /><br />and only 11 mb of free ram at start.<br /></div>
</div>
<div class='comment'>
<div class='author'>Will Price</div>
<div class='content'>
RAM? It has plenty of RAM for running MPD, it just has squat all flash storage space, I installed it on an external memory stick (check out the OpenWRT opkg wiki page)</div>
</div>
<div class='comment'>
<div class='author'>deff</div>
<div class='content'>
well, just wondering how you managed it, Mpd is already exploding my ram by itself.</div>
</div>
</div>

    </div>
</div>
 
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'willprice'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </section>
    </div>
	</div><!-- container -->


<!-- End Document
================================================== -->
</body>
</html>
